<!DOCTYPE html>
<html>
  <head>
    <title>VAD test site</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.18.0/dist/ort.js"></script>
    <script src="bundle.dev.js"></script>
</head>
<body>
    <main class="my-5 mx-auto prose">
      <h1>Okay let's back the fuck up</h1>
      <p>Here is an example worklet</p>
      <pre class="not-prose"><code class="language-javascript">class RandomNoiseProcessor extends AudioWorkletProcessor {
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    output.forEach((channel) => {
      for (let i = 0; i < channel.length; i++) {
        channel[i] = Math.random() * 2 - 1;
      }
    });
    return true;
  }
}
registerProcessor("my-processor", RandomNoiseProcessor);</code></pre>
      <textarea name="worklet" class="w-full h-96" id="worklet"></textarea>
      <script>
        function getWorklet() {
            const textarea = document.getElementById('worklet');
            const text = textarea.value;
            const dataUrl = 'data:text/plain;charset=utf-8,' + encodeURIComponent(text);
            return dataUrl;
        }
        
        // Expose the function to the global window object
        window.getWorklet = getWorklet;
    </script>
      <pre class="not-prose"><code class="language-javascript">stream = await navigator.mediaDevices.getUserMedia({
  audio: {
    channelCount: 1,
    echoCancellation: true,
    autoGainControl: true,
    noiseSuppression: true,
  },
})
audioContext = new AudioContext()
streamNode = new MediaStreamAudioSourceNode(audioContext, {
  mediaStream: stream,
})
workletDataUrl = getWorklet()
audioContext.audioWorklet.addModule(workletDataUrl)
workletNode = new AudioWorkletNode(this.audioContext, "my-processor")</code></pre>
        <h1>You got it</h1>
        <p>
            Open up the console and run the following:
        </p>
        <pre class="not-prose"><code class="language-javascript">v = await vad.MicVAD.new({})
await v.init()</code></pre>
        </main>
  </body>
</html>
